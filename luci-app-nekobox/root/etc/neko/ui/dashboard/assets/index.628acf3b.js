var at=Object.defineProperty,lt=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var Ie=(n,t,s)=>t in n?at(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,C=(n,t)=>{for(var s in t||(t={}))ct.call(t,s)&&Ie(n,s,t[s]);if(Le)for(var s of Le(t))it.call(t,s)&&Ie(n,s,t[s]);return n},I=(n,t)=>lt(n,rt(t));import{R as e,c as w,f as ut,r as m,a as le,E as He,b as mt,d as Q,e as we,u as Ee,g as Ce,h as O,i as Ue,j as be,k as ee,l as Oe,m as dt,n as he,o as pt,p as Ne,q as ft,s as Pe,t as Et,v as ht,w as yt,x as xt,y as gt,z as vt,A as wt,B as Ct,C as bt,D as Nt,F as Pt,G as St,H as kt,N as Dt,O as Ft,I as At,J as pe,K as $t,L as Lt,M as It}from"./vendor.356502e2.js";const Rt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function s(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=s(a);fetch(a.href,l)}};Rt();function se(){return navigator.userAgent==="ClashX Runtime"}let P=null;class Bt{constructor(t){this.instance=null,window.WebViewJavascriptBridge!=null&&(this.instance=window.WebViewJavascriptBridge),this.initBridge(s=>{this.instance=s,t()})}initBridge(t){if(!se())return t==null?void 0:t(null);if(window.WebViewJavascriptBridge!=null)return t(window.WebViewJavascriptBridge);if(window.WVJBCallbacks!=null)return window.WVJBCallbacks.push(t);window.WVJBCallbacks=[t];const s=document.createElement("iframe");s.style.display="none",s.src="https://__bridge_loaded__",document.documentElement.appendChild(s),setTimeout(()=>document.documentElement.removeChild(s),0)}async callHandler(t,s){return await new Promise(o=>{var a;(a=this.instance)==null||a.callHandler(t,s,o)})}async ping(){return await this.callHandler("ping")}async readConfigString(){return await this.callHandler("readConfigString")}async getPasteboard(){return await this.callHandler("getPasteboard")}async getAPIInfo(){return await this.callHandler("apiInfo")}async setPasteboard(t){return await this.callHandler("setPasteboard",t)}async writeConfigWithString(t){return await this.callHandler("writeConfigWithString",t)}async setSystemProxy(t){return await this.callHandler("setSystemProxy",t)}async getStartAtLogin(){return await this.callHandler("getStartAtLogin")}async getProxyDelay(t){return await this.callHandler("speedTest",t)}async setStartAtLogin(t){return await this.callHandler("setStartAtLogin",t)}async isSystemProxySet(){return await this.callHandler("isSystemProxySet")}}function Tt(n){if(P!=null){n();return}P=new Bt(n)}function X(n){const{title:t,children:s,className:o,style:a}=n;return e.createElement("header",{className:w("header",o),style:a},e.createElement("h1",{className:"md:text-xl"},t),e.createElement("div",{className:"flex flex-auto items-center justify-end"},s))}function U(n){const{type:t,size:s=14,className:o,style:a}=n,l=w("clash-iconfont",`icon-${t}`,o),r=C({fontSize:s},a),i=I(C({},n),{className:l,style:r});return e.createElement("i",C({},i))}function _(){}function Mt(n,t){const s=[],o=[];for(const a of n)t(a)?s.push(a):o.push(a);return[s,o]}function W(n){var o;const t=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(n||1)/Math.log(1024));return`${ut(n/Math.pow(1024,s),2).toFixed(2)} ${(o=t==null?void 0:t[s])!=null?o:""}`}function je(n){return n.replace(/.*[/\\]/,"")}function fe(n){const{className:t,checked:s=!1,disabled:o=!1,onChange:a=_}=n,l=w("switch",{checked:s,disabled:o},t);function r(){o||a(!s)}return e.createElement("div",{className:l,onClick:r},e.createElement(U,{className:"switch-icon font-bold",type:"check",size:20}))}const H=m.exports.forwardRef((n,t)=>{const{className:s,style:o,children:a}=n;return e.createElement("div",{className:w("card",s),style:o,ref:t},a)});function Re(n){const{options:t,value:s,onSelect:o}=n;return e.createElement("div",{className:"button-select"},t.map(a=>e.createElement("button",{value:a.value,key:a.value,className:w("button-select-options",{actived:s===a.value}),onClick:()=>o==null?void 0:o(a.value)},a.label)))}const zt={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connections",Version:"Version"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow Lan",proxyMode:"Mode",logLevel:"Log Level",redirProxyPort:"Redir proxy port",socks5ProxyPort:"Socks5 proxy port",httpProxyPort:"HTTP proxy port",mixedProxyPort:"Mixed proxy port",externalController:"External controller"},values:{cn:"\u4E2D\u6587",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version\uFF1A{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret"}},Logs:{title:"Logs",levelLabel:"Log level"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},columns:{host:"Host",sniffHost:"Sniff Host",network:"Network",type:"Type",chains:"Chains",process:"Process",rule:"Rule",time:"Time",speed:"Speed",upload:"Upload",download:"Download",sourceIP:"Source IP",destinationIP:"Destination IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"Target",dstIPEmpty:"Empty",srcIP:"Source",upload:"Upload",download:"Download",network:"Network",process:"Process",processPath:"Path",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Collapse",speedTestText:"Speed Test",breakConnectionsText:"Close connections which include the group"},Modal:{ok:"Ok",cancel:"Cancel"}},Ht={SideBar:{Proxies:"\u4EE3\u7406",Overview:"\u603B\u89C8",Logs:"\u65E5\u5FD7",Rules:"\u89C4\u5219",Settings:"\u8BBE\u7F6E",Connections:"\u8FDE\u63A5",Version:"\u7248\u672C"},Settings:{title:"\u8BBE\u7F6E",labels:{startAtLogin:"\u5F00\u673A\u65F6\u542F\u52A8",language:"\u8BED\u8A00",setAsSystemProxy:"\u8BBE\u7F6E\u4E3A\u7CFB\u7EDF\u4EE3\u7406",allowConnectFromLan:"\u5141\u8BB8\u6765\u81EA\u5C40\u57DF\u7F51\u7684\u8FDE\u63A5",proxyMode:"\u4EE3\u7406\u6A21\u5F0F",logLevel:"\u65E5\u5FD7\u7B49\u7EA7",redirProxyPort:"Redir \u4EE3\u7406\u7AEF\u53E3",socks5ProxyPort:"Socks5 \u4EE3\u7406\u7AEF\u53E3",httpProxyPort:"HTTP \u4EE3\u7406\u7AEF\u53E3",mixedProxyPort:"\u6DF7\u5408\u4EE3\u7406\u7AEF\u53E3",externalController:"\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E"},values:{cn:"\u4E2D\u6587",en:"English",global:"\u5168\u5C40",rules:"\u89C4\u5219",direct:"\u76F4\u8FDE",script:"\u811A\u672C"},versionString:"\u5F53\u524D ClashX \u5DF2\u662F\u6700\u65B0\u7248\u672C\uFF1A{{version}}",checkUpdate:"\u68C0\u67E5\u66F4\u65B0",externalControllerSetting:{title:"\u7F16\u8F91\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E",note:"\u8BF7\u6CE8\u610F\uFF0C\u4FEE\u6539\u8BE5\u914D\u7F6E\u9879\u5E76\u4E0D\u4F1A\u4FEE\u6539\u4F60\u7684 Clash \u914D\u7F6E\u6587\u4EF6\uFF0C\u8BF7\u786E\u8BA4\u4FEE\u6539\u540E\u7684\u5916\u90E8\u63A7\u5236\u5730\u5740\u548C Clash \u914D\u7F6E\u6587\u4EF6\u5185\u7684\u5730\u5740\u4E00\u81F4\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4 Dashboard \u65E0\u6CD5\u8FDE\u63A5\u3002",host:"Host",port:"\u7AEF\u53E3",secret:"\u5BC6\u94A5"}},Logs:{title:"\u65E5\u5FD7",levelLabel:"\u65E5\u5FD7\u7B49\u7EA7"},Rules:{title:"\u89C4\u5219",providerTitle:"\u89C4\u5219\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",ruleCount:"\u89C4\u5219\u6761\u6570"},Connections:{title:"\u8FDE\u63A5",keepClosed:"\u4FDD\u7559\u5173\u95ED\u8FDE\u63A5",total:{text:"\u603B\u91CF",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D"},closeAll:{title:"\u8B66\u544A",content:"\u5C06\u4F1A\u5173\u95ED\u6240\u6709\u8FDE\u63A5"},filter:{all:"\u5168\u90E8"},columns:{host:"\u57DF\u540D",sniffHost:"\u55C5\u63A2\u57DF\u540D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",type:"\u7C7B\u578B",chains:"\u8282\u70B9\u94FE",rule:"\u89C4\u5219",time:"\u8FDE\u63A5\u65F6\u95F4",speed:"\u901F\u7387",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",sourceIP:"\u6765\u6E90 IP",destinationIP:"\u76EE\u6807 IP"},info:{title:"\u8FDE\u63A5\u4FE1\u606F",id:"ID",host:"\u57DF\u540D",hostEmpty:"\u7A7A",dstIP:"\u76EE\u6807 IP",dstIPEmpty:"\u7A7A",srcIP:"\u6765\u6E90",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",network:"\u7F51\u7EDC",process:"\u8FDB\u7A0B",processPath:"\u8DEF\u5F84",inbound:"\u5165\u53E3",rule:"\u89C4\u5219",chains:"\u4EE3\u7406",status:"\u72B6\u6001",opening:"\u8FDE\u63A5\u4E2D",closed:"\u5DF2\u5173\u95ED",closeConnection:"\u5173\u95ED\u8FDE\u63A5"}},Proxies:{title:"\u4EE3\u7406",editDialog:{title:"\u7F16\u8F91\u4EE3\u7406",color:"\u989C\u8272",name:"\u540D\u5B57",type:"\u7C7B\u578B",server:"\u670D\u52A1\u5668",port:"\u7AEF\u53E3",password:"\u5BC6\u7801",cipher:"\u52A0\u5BC6\u65B9\u5F0F",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"\u7B56\u7565\u7EC4",providerTitle:"\u4EE3\u7406\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",expandText:"\u5C55\u5F00",collapseText:"\u6536\u8D77",speedTestText:"\u6D4B\u901F",breakConnectionsText:"\u5207\u6362\u65F6\u6253\u65AD\u5305\u542B\u7B56\u7565\u7EC4\u7684\u8FDE\u63A5"},Modal:{ok:"\u786E \u5B9A",cancel:"\u53D6 \u6D88"}},Ge={en_US:zt,zh_CN:Ht},Ut=Object.keys(Ge);function Ot(){for(const n of window.navigator.languages){if(n.includes("zh"))return"zh_CN";if(n.includes("us"))return"en_US"}return"en_US"}function Se(n){return m.exports.useMemo(()=>{function s(o,a){if(typeof o=="string")n(l=>{const r=o,i=a;l[r]=i});else if(typeof o=="function"){const l=o;n(r=>l(r))}else typeof o=="object"&&n(l=>le(l,r=>{const i=o;for(const u of Object.keys(i)){const E=u;r[E]=i[E]}}))}return s},[n])}class We{constructor(t){this.EE=new He,this.innerBuffer=[],this.url="",this.connection=null,this.config=Object.assign({bufferLength:0,retryInterval:5e3},t)}connectWebsocket(){const t=new URL(this.url);this.connection=new WebSocket(t.toString()),this.connection.addEventListener("message",s=>{const o=JSON.parse(s.data);this.EE.emit("data",[o]),this.config.bufferLength>0&&(this.innerBuffer.push(o),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),this.connection.addEventListener("error",s=>{var o;this.EE.emit("error",s),(o=this.connection)==null||o.close(),setTimeout(this.connectWebsocket,this.config.retryInterval)})}connect(t){var s;this.url===t&&this.connection||(this.url=t,(s=this.connection)==null||s.close(),this.connectWebsocket())}subscribe(t,s){this.EE.addListener(t,s)}unsubscribe(t,s){this.EE.removeListener(t,s)}buffer(){return this.innerBuffer.slice()}destory(){var t;this.EE.removeAllListeners(),(t=this.connection)==null||t.close(),this.connection=null}}class jt{constructor(t,s){this.axiosClient=mt.create({baseURL:t,headers:s?{Authorization:`Bearer ${s}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(t){return await this.axiosClient.patch("configs",t)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const t=await this.axiosClient.get("providers/proxies",{validateStatus(s){return s>=200&&s<300||s===404}});return t.status===404&&(t.data={providers:{}}),t}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(t){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(t)}`)}async updateRuleProvider(t){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(t)}`)}async healthCheckProvider(t){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(t)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(t){return await this.axiosClient.get(`proxies/${encodeURIComponent(t)}/delay`,{params:{timeout:5e3,url:"http://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(t){return await this.axiosClient.delete(`connections/${t}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(t,s){return await this.axiosClient.put(`proxies/${encodeURIComponent(t)}`,{name:s})}}const Gt=Q(async()=>{if(!se())return null;const n=await P.getAPIInfo();return{hostname:n.host,port:n.port,secret:n.secret,protocol:"http:"}}),_e=we("externalControllers",[]);function re(){var E,f,p,d,h,g,v,F,k,S,V,N,j,R,$;const n=Ee(Gt),t=Ce(),s=Ee(_e);if(n!=null)return n;let o;{const B=document.querySelector('meta[name="external-controller"]');((E=B==null?void 0:B.content)==null?void 0:E.match(/^https?:/))!=null&&(o=new URL(B.content))}const a=new URLSearchParams(t.search),l=(h=(d=(p=a.get("host"))!=null?p:(f=s==null?void 0:s[0])==null?void 0:f.hostname)!=null?d:o==null?void 0:o.hostname)!=null?h:"127.0.0.1",r=(k=(F=(v=a.get("port"))!=null?v:(g=s==null?void 0:s[0])==null?void 0:g.port)!=null?F:o==null?void 0:o.port)!=null?k:"9090",i=(j=(N=(V=a.get("secret"))!=null?V:(S=s==null?void 0:s[0])==null?void 0:S.secret)!=null?N:o==null?void 0:o.username)!=null?j:"",u=((R=a.get("protocol"))!=null?R:l==="127.0.0.1")?"http:":($=o==null?void 0:o.protocol)!=null?$:window.location.protocol;return{hostname:l,port:r,secret:i,protocol:u}}const Wt=Q({key:"",instance:null});function z(){const{hostname:n,port:t,secret:s,protocol:o}=re(),[a,l]=O(Wt),r=`${o}//${n}:${t}?secret=${s}`;if(a.key===r)return a.instance;const i=new jt(`${o}//${n}:${t}`,s);return l({key:r,instance:i}),i}const ke=Q(!0),_t=we("language",void 0);function D(){const[n,t]=O(_t),s=m.exports.useMemo(()=>n!=null?n:Ot(),[n]),o=m.exports.useCallback(function(a){function l(r){return pt(Ge[s][a],r)}return{t:l}},[s]);return{lang:s,locales:Ut,setLang:t,translation:o}}const Ve=Q({version:"",premium:!1,meta:!1});function Je(){const[n,t]=O(Ve),s=z(),o=be(ke);return ee([s],async function(){const a=await Oe.fromPromise(s.getVersion(),l=>l);o(a.isOk()),t(a.isErr()?{version:"",premium:!1,meta:!1}:{version:a.value.data.version,premium:!!a.value.data.premium,meta:!!a.value.data.meta})}),n}function Ye(){const[{premium:n,meta:t}]=O(Ve),s=z(),{data:o,mutate:a}=ee(["/providers/rule",s,n,t],async()=>{if(!n&&!t)return[];const l=await s.getRuleProviders();return Object.keys(l.data.providers).map(r=>l.data.providers[r])});return{providers:o!=null?o:[],update:a}}const Vt=we("profile",{breakConnections:!1,logLevel:""});function me(){const[n,t]=O(Vt),s=m.exports.useCallback(o=>{t(le(n,o))},[n,t]);return{data:n,set:Se(s)}}const Xe=Q([]);function Ke(){const[n,t]=O(Xe),s=z(),{data:o,mutate:a}=ee(["/providers/proxy",s],async()=>{const l=await s.getProxyProviders();return Object.keys(l.data.providers).map(r=>l.data.providers[r]).filter(r=>r.name!=="default").filter(r=>r.vehicleType!=="Compatible")});return m.exports.useEffect(()=>{t(o!=null?o:[])},[o,t]),{providers:n,update:a}}function De(){const n=z(),{data:t,mutate:s}=ee(["/config",n],async()=>{var l;const a=(await n.getConfig()).data;return{port:a.port,socksPort:a["socks-port"],mixedPort:(l=a["mixed-port"])!=null?l:0,redirPort:a["redir-port"],mode:a.mode.toLowerCase(),logLevel:a["log-level"],allowLan:a["allow-lan"]}});return{general:t!=null?t:{},update:s}}const qe=Ue({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function de(){const[n,t]=O(qe),s=Se(t),o=z(),{mutate:a}=ee(["/proxies",o],async()=>{const r=await o.getProxies(),i=r.data.proxies.GLOBAL;i.name="GLOBAL";const u=new Set(["Selector","URLTest","Fallback","LoadBalance"]),E=new Set(["DIRECT","REJECT","GLOBAL"]),f=i.all.filter(h=>!E.has(h)).map(h=>I(C({},r.data.proxies[h]),{name:h})),[p,d]=Mt(f,h=>!u.has(h.type));s({proxies:p,groups:d,global:i})}),l=m.exports.useCallback((r,i)=>{s(u=>{r==="GLOBAL"&&(u.global.now=i);for(const E of u.groups)E.name===r&&(E.now=i)})},[s]);return{proxies:n.proxies,groups:n.groups,global:n.global,update:a,markProxySelected:l,set:s}}const Ze=Q(n=>{const t=n(qe),s=n(Xe),o=new Map;for(const a of t.proxies)o.set(a.name,a);for(const a of s)for(const l of a.proxies)o.set(l.name,l);return o});function Qe(){const{data:n,mutate:t}=ee("/clashx",async()=>{var a,l;if(!se())return{isClashX:!1,startAtLogin:!1,systemProxy:!1};const s=(a=await(P==null?void 0:P.getStartAtLogin()))!=null?a:!1,o=(l=await(P==null?void 0:P.isSystemProxySet()))!=null?l:!1;return{startAtLogin:s,systemProxy:o,isClashX:!0}});return{data:n,update:t}}const Jt=Ue([]);function Yt(){const[n,t]=O(Jt),s=Se(t),o=z();async function a(){const l=await o.getRules();s(l.data.rules)}return{rules:n,update:a}}const Xt=Q(new We({bufferLength:200}));function et(){const n=re(),{general:t}=De(),{data:{logLevel:s}}=me(),o=Ee(Xt),a=s||t.logLevel,l=dt(`${n.protocol}//${n.hostname}:${n.port}/logs?level=${a}&secret=${encodeURIComponent(n.secret)}`),r=he(n);return m.exports.useEffect(()=>{if(a){const i=r.current,E=`${i.protocol==="http:"?"ws:":"wss:"}//${i.hostname}:${i.port}/logs?level=${a}&token=${encodeURIComponent(i.secret)}`;o.connect(E)}},[r,o,a,l]),o}function Kt(){const n=re(),t=m.exports.useRef(new We({bufferLength:200})),o=`${n.protocol==="http:"?"ws:":"wss:"}//${n.hostname}:${n.port}/connections?token=${encodeURIComponent(n.secret)}`;return m.exports.useEffect(()=>{t.current.connect(o)},[o]),t.current}const Be={"#909399":0,"#57b366":260,"#ff9a28":600,"#ff3e5e":1/0};function qt(n){const{className:t,data:s,onClick:o,select:a,canClick:l,errSet:r,rowHeight:i}=n,{translation:u}=D(),{t:E}=u("Proxies"),[f,p]=m.exports.useState(!1),[d,h]=m.exports.useState(!1),[g]=O(Ze),v=m.exports.useRef(null);m.exports.useLayoutEffect(()=>{var N,j;h(((j=(N=v==null?void 0:v.current)==null?void 0:N.offsetHeight)!=null?j:0)>30)},[]);const F=f?"auto":i,k=l?o:_;function S(){p(!f)}const V=s.map(N=>{var te;const R=w(l?"cursor-pointer":"cursor-default",{"tags-selected":a===N,error:r==null?void 0:r.has(N)}),$=(te=g.get(N))==null?void 0:te.history,B=$!=null&&$.length?$.slice(-1)[0].delay:0,oe=Object.keys(Be).find(T=>B<=Be[T]);return e.createElement("li",{className:R,key:N,onClick:()=>k(N)},N," ",e.createElement("span",{className:"proxy-delay",style:{color:oe}},"\u2003",B===0?"":`${B}ms`,"  "))});return e.createElement("div",{className:w("flex items-start overflow-y-hidden",t),style:{height:F}},e.createElement("ul",{ref:v,className:w("tags",{expand:f})},V),d&&e.createElement("span",{className:"h-7 px-5 select-none cursor-pointer leading-7",onClick:S},E(f?"collapseText":"expandText")))}function Z(n){const{className:t,style:s,value:o="",align:a="center",inside:l=!1,autoFocus:r=!1,type:i="text",disabled:u=!1,onChange:E=_,onBlur:f=_,onEnter:p=_}=n,d=w("input",`text-${a}`,{"focus:shadow-none":l},t);function h(g){g.code==="Enter"&&p(g)}return e.createElement("input",{disabled:u,className:d,style:s,value:o,autoFocus:r,type:i,onChange:g=>E(g.target.value,g),onBlur:f,onKeyDown:h})}function Zt(n){const{value:t,options:s,onSelect:o,className:a,style:l}=n,r=m.exports.useRef(document.createElement("div")),i=m.exports.useRef(null),[u,E]=m.exports.useState(!1),[f,p]=m.exports.useState({});m.exports.useLayoutEffect(()=>{const v=i.current.getBoundingClientRect();p({top:Math.floor(v.top+v.height)+6,left:Math.floor(v.left)-10})},[]),m.exports.useLayoutEffect(()=>{const v=r.current;return document.body.appendChild(v),()=>{document.body.removeChild(v)}},[]);function d(){E(!u)}const h=m.exports.useMemo(()=>s.find(v=>v.value===t),[t,s]),g=e.createElement("div",{className:w("select-list",{"select-list-show":u}),style:f},e.createElement("ul",{className:"list"},s.map(v=>{var F;return e.createElement(Qt,{className:w({selected:v.value===t}),onClick:k=>{o==null||o(v.value,k),E(!1)},disabled:v.disabled,key:(F=v.key)!=null?F:v.value,value:v.value},v.label)})));return e.createElement(e.Fragment,null,e.createElement("div",{className:w("select",a),style:l,ref:i,onClick:d},h==null?void 0:h.label,e.createElement(U,{type:"triangle-down"})),Ne.exports.createPortal(g,r.current))}function Qt(n){const{className:t,style:s,disabled:o=!1,children:a,onClick:l=_}=n,r=w("option",{disabled:o},t);return e.createElement("li",{className:r,style:s,onClick:l},a)}function tt(n){const{show:t=!0,title:s="Modal",size:o="small",footer:a=!0,onOk:l=_,onClose:r=_,bodyClassName:i,bodyStyle:u,className:E,style:f,children:p}=n,{translation:d}=D(),{t:h}=d("Modal"),g=m.exports.useRef(document.createElement("div")),v=m.exports.useRef(null);m.exports.useLayoutEffect(()=>{const S=g.current;return document.body.appendChild(S),()=>{document.body.removeChild(S)}},[]);function F(S){S.target===v.current&&r()}const k=e.createElement("div",{className:w("modal-mask",{"modal-show":t}),ref:v,onMouseDown:F},e.createElement("div",{className:w("modal",`modal-${o}`,E),style:f},e.createElement("div",{className:"modal-title"},s),e.createElement("div",{className:w("modal-body",i),style:u},p),a&&e.createElement("div",{className:"footer"},e.createElement(ye,{onClick:()=>r()},h("cancel")),e.createElement(ye,{type:"primary",onClick:()=>l()},h("ok")))));return Ne.exports.createPortal(k,g.current)}const en={success:"check",info:"info",warning:"info",error:"close"};function tn(n){const{message:t="",type:s="info",inside:o=!1,children:a,className:l,style:r}=n,i=w("alert",`alert-${o?"note":"box"}-${s}`,l);return e.createElement("div",{className:i,style:r},e.createElement("span",{className:"alert-icon"},e.createElement(U,{type:en[s],size:26})),t?e.createElement("p",{className:"alert-message"},t):e.createElement("div",{className:"alert-message"},a))}function ye(n){const{type:t="normal",onClick:s=_,children:o,className:a,style:l,disiabled:r}=n,i=w("button",`button-${t}`,a,{"button-disabled":r});return e.createElement("button",{className:i,style:l,onClick:s,disabled:r},o)}function ue(n){const[t,s]=ft(n),o=m.exports.useMemo(()=>{function a(l,r){typeof l=="string"?s(i=>{const u=l,E=r;i[u]=E}):typeof l=="function"?s(l):typeof l=="object"&&s(i=>{const u=l;for(const E of Object.keys(u)){const f=E;i[f]=u[f]}})}return a},[s]);return[t,o]}function nn(n,t=0){if(n.length<2)throw new Error("List requires at least two elements");const[s,o]=m.exports.useState(t);function a(){o((s+1)%n.length)}return{current:m.exports.useMemo(()=>n[s],[n,s]),next:a}}function Fe(n=!1){const[t,s]=m.exports.useState(n);function o(){s(!1)}function a(){s(!0)}return{visible:t,hide:o,show:a}}function nt(n){const{className:t,checked:s=!1,onChange:o=_}=n,a=w("checkbox",{checked:s},t);function l(){o(!s)}return e.createElement("div",{className:a,onClick:l},e.createElement(U,{className:"checkbox-icon",type:"check",size:18}),e.createElement("div",null,n.children))}function ne(n){const{color:t,className:s,style:o}=n,a=w("tag",s),l=C({color:t},o),r=I(C({},n),{className:a,style:l});return e.createElement("span",C({},r),n.children)}function sn(n){const t=w("spinner",n.className);return e.createElement("div",{className:t},e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})))}function st(n){const t=w("loading","visible",n.className);return n.visible?e.createElement("div",{className:t},e.createElement(sn,{className:n.spinnerClassName})):null}function on(n){var a,l,r;const t=m.exports.useRef(document.createElement("div"));m.exports.useLayoutEffect(()=>{const i=t.current;return document.body.appendChild(i),()=>{document.body.removeChild(i)}},[]);const s="absolute h-full right-0 transition-transform transform translate-x-full duration-100 pointer-events-auto",o=e.createElement("div",{className:w(n.className,"absolute inset-0 pointer-events-none z-9999")},e.createElement(H,{className:w(s,n.bodyClassName,{"translate-x-0":n.visible}),style:{width:(a=n.width)!=null?a:400}},n.children));return Ne.exports.createPortal(o,(r=(l=n.containerRef)==null?void 0:l.current)!=null?r:t.current)}Pe.extend(Et);function Ae(n,t){const s=t==="en_US"?"en":"zh-cn";return Pe().locale(s).from(n)}function an(n){const{translation:t}=D(),s=m.exports.useMemo(()=>t("Connections").t,[t]),{className:o,style:a}=n,l=w("flex flex-wrap px-1",o);function r(i){var u;(u=n.onChange)==null||u.call(n,i)}return e.createElement("div",{className:l,style:a},e.createElement("div",{className:w("connections-devices-item pt-2 mb-2",{selected:n.selected===""}),onClick:()=>r("")},s("filter.all")),n.devices.map(i=>e.createElement("div",{key:i.label,className:w("connections-devices-item pt-2 mb-2",{selected:n.selected===i.label}),onClick:()=>r(i.label)},i.label," (",i.number,")")))}function ln(n){var o,a,l,r,i,u,E,f,p,d,h,g,v;const{translation:t}=D(),s=m.exports.useMemo(()=>t("Connections").t,[t]);return e.createElement("div",{className:w(n.className,"text-xs flex flex-col overflow-y-auto")},e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.id")),e.createElement("span",{className:"font-mono"},n.connection.id)),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.network")),e.createElement("span",{className:"font-mono"},(o=n.connection.metadata)==null?void 0:o.network)),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.inbound")),e.createElement("span",{className:"font-mono"},(a=n.connection.metadata)==null?void 0:a.type))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.host")),e.createElement("span",{className:"font-mono flex-1 break-all"},n.connection.metadata?`${n.connection.metadata.host||n.connection.metadata.destinationIP}:${(l=n.connection.metadata)==null?void 0:l.destinationPort}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.host")),e.createElement("span",{className:"font-mono flex-1 break-all"},n.connection.metadata?`${n.connection.metadata.sniffHost}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.dstIP")),e.createElement("span",{className:"font-mono"},n.connection.metadata?`${((r=n.connection.metadata)==null?void 0:r.remoteDestination)||((i=n.connection.metadata)==null?void 0:i.destinationIP)||((u=n.connection.metadata)==null?void 0:u.host)}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.srcIP")),e.createElement("span",{className:"font-mono"},`${(E=n.connection.metadata)==null?void 0:E.sourceIP}:${(f=n.connection.metadata)==null?void 0:f.sourcePort}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.process")),e.createElement("span",{className:"font-mono"},(p=n.connection.metadata)!=null&&p.processPath?`${je(n.connection.metadata.processPath)}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.processPath")),e.createElement("span",{className:"font-mono flex-1 break-all"},(d=n.connection.metadata)!=null&&d.processPath?`${n.connection.metadata.processPath}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.rule")),e.createElement("span",{className:"font-mono"},n.connection.rule&&`${n.connection.rule}${n.connection.rulePayload&&` :: ${n.connection.rulePayload}`}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.chains")),e.createElement("span",{className:"font-mono flex-1 break-all"},(h=n.connection.chains)==null?void 0:h.slice().reverse().join(" / "))),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.upload")),e.createElement("span",{className:"font-mono"},W((g=n.connection.upload)!=null?g:0))),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-20"},s("info.download")),e.createElement("span",{className:"font-mono"},W((v=n.connection.download)!=null?v:0)))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-20"},s("info.status")),e.createElement("span",{className:"font-mono"},n.connection.completed?e.createElement("span",{className:"text-red"},s("info.closed")):e.createElement("span",{className:"text-green"},s("info.opening")))))}class rn{constructor(){this.connections=new Map,this.saveDisconnection=!1}appendToSet(t){var o;const s=t.reduce((a,l)=>a.set(l.id,l),new Map);for(const a of this.connections.keys())if(!s.has(a))if(!this.saveDisconnection)this.connections.delete(a);else{const l=this.connections.get(a);l!=null&&this.connections.set(a,le(l,r=>{r.completed=!0,r.uploadSpeed=0,r.downloadSpeed=0}))}for(const a of s.keys()){if(!this.connections.has(a)){this.connections.set(a,I(C({},s.get(a)),{uploadSpeed:0,downloadSpeed:0}));continue}const l=this.connections.get(a),r=s.get(a);(o=this.connections)==null||o.set(a,I(C({},r),{uploadSpeed:r.upload-l.upload,downloadSpeed:r.download-l.download}))}}toggleSave(){var t,s;if(this.saveDisconnection){this.saveDisconnection=!1;for(const o of this.connections.keys())(s=(t=this.connections)==null?void 0:t.get(o))!=null&&s.completed&&this.connections.delete(o)}else this.saveDisconnection=!0;return this.saveDisconnection}getConnections(){return[...this.connections.values()]}}function cn(){const n=m.exports.useMemo(()=>new rn,[]),t=m.exports.useRef(!0),[s,o]=m.exports.useState([]),[a,l]=m.exports.useState(!1),r=m.exports.useCallback(function(u){n.appendToSet(u),t.current&&o(n.getConnections()),t.current=!t.current},[n]),i=m.exports.useCallback(function(){const u=n.toggleSave();l(u),u||o(n.getConnections()),t.current=!0},[n]);return{connections:s,feed:r,toggleSave:i,save:a}}const x={Host:"host",SniffHost:"sniffHost",Network:"network",Process:"process",Type:"type",Chains:"chains",Rule:"rule",Speed:"speed",Upload:"upload",Download:"download",SourceIP:"sourceIP",DestinationIP:"destinationIP",Time:"time"},un=new Set([x.Network,x.Type,x.Speed,x.Upload,x.Download,x.SourceIP,x.Time,x.Process]);function mn(n,t){switch(!0){case(n===0&&t===0):return"-";case(n!==0&&t!==0):return`\u2191 ${W(n)}/s \u2193 ${W(t)}/s`;case n!==0:return`\u2191 ${W(n)}/s`;default:return`\u2193 ${W(t)}/s`}}const A=ht().setRowType();function dn(){const{translation:n,lang:t}=D(),s=m.exports.useMemo(()=>n("Connections").t,[n]),o=Kt(),a=he(o),l=z(),r=m.exports.useRef(null),[i,u]=ue({uploadTotal:0,downloadTotal:0}),{visible:E,show:f,hide:p}=Fe();function d(){l.closeAllConnections().finally(()=>p())}const{connections:h,feed:g,save:v,toggleSave:F}=cn(),k=m.exports.useMemo(()=>h.map(c=>({id:c.id,host:`${c.metadata.host||c.metadata.destinationIP}:${c.metadata.destinationPort}`,sniffHost:c.metadata.sniffHost,chains:c.chains.slice().reverse().join(" / "),rule:c.rulePayload?`${c.rule} :: ${c.rulePayload}`:c.rule,time:new Date(c.start).getTime(),upload:c.upload,download:c.download,sourceIP:c.metadata.sourceIP,destinationIP:`${c.metadata.remoteDestination||c.metadata.destinationIP||c.metadata.host}`,type:c.metadata.type,network:c.metadata.network.toUpperCase(),process:c.metadata.processPath,speed:{upload:c.uploadSpeed,download:c.downloadSpeed},completed:!!c.completed,original:c})),[h]),S=m.exports.useMemo(()=>{const c=yt(h,"metadata.sourceIP");return Object.keys(c).map(b=>({label:b,number:c[b].length})).sort((b,y)=>b.label.localeCompare(y.label))},[h]),V=m.exports.useRef(null),N=xt(V,{threshold:[1]}),j=m.exports.useMemo(()=>A.createColumns([A.createDataColumn(x.Host,{minSize:260,size:260,header:s(`columns.${x.Host}`)}),A.createDataColumn(x.SniffHost,{minSize:260,size:200,header:s(`columns.${x.SniffHost}`)}),A.createDataColumn(x.Network,{minSize:80,size:80,header:s(`columns.${x.Network}`)}),A.createDataColumn(x.Type,{minSize:100,size:100,header:s(`columns.${x.Type}`)}),A.createDataColumn(x.Chains,{minSize:200,size:200,header:s(`columns.${x.Chains}`)}),A.createDataColumn(x.Rule,{minSize:140,size:140,header:s(`columns.${x.Rule}`)}),A.createDataColumn(x.Process,{minSize:100,size:100,header:s(`columns.${x.Process}`),cell:c=>c.value?je(c.value):"-"}),A.createDataColumn(c=>[c.speed.upload,c.speed.download],{id:x.Speed,header:s(`columns.${x.Speed}`),minSize:200,size:200,sortDescFirst:!0,sortingFn(c,b){var G,M,q,$e;const y=(M=(G=c.original)==null?void 0:G.speed)!=null?M:{upload:0,download:0},L=($e=(q=b.original)==null?void 0:q.speed)!=null?$e:{upload:0,download:0};return y.download===L.download?y.upload-L.upload:y.download-L.download},cell:c=>mn(c.value[0],c.value[1])}),A.createDataColumn(x.Upload,{minSize:100,size:100,header:s(`columns.${x.Upload}`),cell:c=>W(c.value)}),A.createDataColumn(x.Download,{minSize:100,size:100,header:s(`columns.${x.Download}`),cell:c=>W(c.value)}),A.createDataColumn(x.SourceIP,{minSize:140,size:140,header:s(`columns.${x.SourceIP}`),filterFn:"equals"}),A.createDataColumn(x.DestinationIP,{minSize:140,size:140,header:s(`columns.${x.DestinationIP}`)}),A.createDataColumn(x.Time,{minSize:120,size:120,header:s(`columns.${x.Time}`),cell:c=>Ae(new Date(c.value),t),sortingFn:(c,b)=>{var y,L,G,M;return((L=(y=b.original)==null?void 0:y.time)!=null?L:0)-((M=(G=c.original)==null?void 0:G.time)!=null?M:0)}})]),[t,s]);m.exports.useLayoutEffect(()=>{function c(b){for(const y of b)u({uploadTotal:y.uploadTotal,downloadTotal:y.downloadTotal}),g(y.connections)}return o==null||o.subscribe("data",c),()=>{o==null||o.unsubscribe("data",c)}},[o,g,u]),gt(()=>{var c;(c=a.current)==null||c.destory()});const R=vt(A,{data:k,columns:j,getCoreRowModel:wt(),getSortedRowModel:Ct(),getColumnFilteredRowModel:bt(),initialState:{sorting:[{id:x.Time,desc:!1}]},columnResizeMode:"onChange",enableColumnResizing:!0,autoResetSorting:!1,autoResetColumnFilters:!1}),$=R.getHeaderGroups()[0],[B,oe]=m.exports.useState("");function te(c){oe(c),R.setColumnFilterValue(x.SourceIP,c||void 0)}const[T,Y]=ue({visible:!1,selectedID:"",connection:{}});function J(){Y(c=>{c.connection.completed=!0}),l.closeConnection(T.selectedID)}const K=he(T.connection);m.exports.useEffect(()=>{var b;const c=(b=k.find(y=>y.id===T.selectedID))==null?void 0:b.original;c?Y(y=>{y.connection=C({},c),T.selectedID===K.current.id&&(y.connection.completed=K.current.completed)}):Object.keys(K.current).length!==0&&!K.current.completed&&Y(y=>{y.connection.completed=!0})},[k,T.selectedID,K,Y]);const ae=m.exports.useMemo(()=>{var c;return((c=N==null?void 0:N.intersectionRatio)!=null?c:0)<1},[N]),ce=$.headers.map((c,b)=>{const y=c.column,L=y.id;return e.createElement("th",I(C({},c.getHeaderProps(G=>le(G,M=>{M.className=w("connections-th",{resizing:y.getIsResizing(),fixed:y.id===x.Host,shadow:ae&&y.id===x.Host}),!M.style&&(M.style={}),M.style.width=c.getSize()}))),{ref:y.id===x.Host?V:void 0,key:L}),e.createElement("div",C({},y.getToggleSortingProps()),c.renderHeader(),y.getIsSorted()!==!1?y.getIsSorted()==="desc"?" \u2193":" \u2191":null),b!==$.headers.length-1&&e.createElement("div",I(C({},c.getResizerProps()),{className:"connections-resizer"})))}),ie=R.getRowModel().rows.map(c=>{var b;return e.createElement("tr",I(C({},c.getRowProps()),{className:"cursor-default select-none",key:(b=c.original)==null?void 0:b.id,onClick:()=>{var y;return Y({visible:!0,selectedID:(y=c.original)==null?void 0:y.id})}}),c.getAllCells().map(y=>{var G;const L=w("connections-block",{"text-center":un.has(y.column.id),completed:(G=c.original)==null?void 0:G.completed},{fixed:y.column.id===x.Host,shadow:ae&&y.column.id===x.Host});return e.createElement("td",I(C({},y.getCellProps(M=>le(M,q=>{!q.style&&(q.style={}),q.className=L,q.style.width=y.column.getSize()}))),{key:y.column.id}),y.renderCell())}))});return e.createElement("div",{className:"page !h-100vh"},e.createElement(X,{title:s("title")},e.createElement("span",{className:"cursor-default flex-1 connections-filter"},`(${s("total.text")}: ${s("total.upload")} ${W(i.uploadTotal)} ${s("total.download")} ${W(i.downloadTotal)})`),e.createElement(nt,{className:"connections-filter",checked:v,onChange:F},s("keepClosed")),e.createElement(U,{className:"connections-filter dangerous",onClick:f,type:"close-all",size:20})),S.length>1&&e.createElement(an,{devices:S,selected:B,onChange:te}),e.createElement(H,{ref:r,className:"connections-card relative"},e.createElement("div",{className:"overflow-auto min-h-full min-w-full"},e.createElement("table",C({},R.getTableProps()),e.createElement("thead",null,e.createElement("tr",I(C({},$.getHeaderGroupProps()),{className:"connections-header"}),ce)),e.createElement("tbody",C({},R.getTableBodyProps()),ie)))),e.createElement(tt,{title:s("closeAll.title"),show:E,onClose:p,onOk:d},s("closeAll.content")),e.createElement(on,{containerRef:r,bodyClassName:"flex flex-col bg-[#15222a] text-[#b7c5d6]",visible:T.visible,width:450},e.createElement("div",{className:"flex h-8 justify-between items-center"},e.createElement("span",{className:"font-bold pl-3"},s("info.title")),e.createElement(U,{type:"close",size:16,className:"cursor-pointer",onClick:()=>Y("visible",!1)})),e.createElement(ln,{className:"mt-3 px-5",connection:T.connection}),e.createElement("div",{className:"flex mt-3 pr-3 justify-end"},e.createElement(ye,{type:"danger",disiabled:T.connection.completed,onClick:()=>J()},s("info.closeConnection")))))}function pn(){const{translation:n}=D(),{t}=n("Settings"),{hostname:s,port:o,secret:a}=re(),[l,r]=O(ke),[i,u]=ue({hostname:"",port:"",secret:""});m.exports.useEffect(()=>{u({hostname:s,port:o,secret:a})},[s,o,a,u]);const E=be(_e);function f(){const{hostname:p,port:d,secret:h}=i;E([{hostname:p,port:d,secret:h}])}return e.createElement(tt,{show:!l,title:t("externalControllerSetting.title"),bodyClassName:"external-controller",onClose:()=>r(!0),onOk:f},e.createElement(tn,{type:"info",inside:!0},e.createElement("p",null,t("externalControllerSetting.note"))),e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"font-bold my-1 w-14 md:my-3"},t("externalControllerSetting.host")),e.createElement(Z,{className:"flex-1 my-1 md:my-3",align:"left",inside:!0,value:i.hostname,onChange:p=>u("hostname",p),onEnter:f})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},t("externalControllerSetting.port")),e.createElement(Z,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:i.port,onChange:p=>u("port",p),onEnter:f})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},t("externalControllerSetting.secret")),e.createElement(Z,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:i.secret,onChange:p=>u("secret",p),onEnter:f})))}const fn=[{label:"Default",value:""},{label:"Debug",value:"debug"},{label:"Info",value:"info"},{label:"Warn",value:"warning"},{label:"Error",value:"error"},{label:"Silent",value:"silent"}],En=new Map([["debug","text-teal-500"],["info","text-sky-500"],["warning","text-pink-500"],["error","text-rose-500"]]);function hn(){var f,p;const n=m.exports.useRef(null),t=m.exports.useRef([]),[s,o]=m.exports.useState([]),{translation:a}=D(),{data:{logLevel:l},set:r}=me(),{t:i}=a("Logs"),u=et(),E=m.exports.useRef((p=(f=n.current)==null?void 0:f.scrollHeight)!=null?p:0);return m.exports.useLayoutEffect(()=>{var h;const d=n.current;d!=null&&E.current===d.scrollTop+d.clientHeight&&(d.scrollTop=d.scrollHeight-d.clientHeight),E.current=(h=d==null?void 0:d.scrollHeight)!=null?h:0}),m.exports.useEffect(()=>{function d(h){t.current=t.current.slice().concat(h.map(g=>I(C({},g),{time:new Date}))),o(t.current)}return u!=null&&(u.subscribe("data",d),t.current=u.buffer(),o(t.current)),()=>u==null?void 0:u.unsubscribe("data",d)},[u]),e.createElement("div",{className:"page"},e.createElement(X,{title:i("title")},e.createElement("span",{className:"text-sm text-primary-darken mr-2"},i("levelLabel"),":"),e.createElement(Zt,{options:fn,value:Nt(l),onSelect:d=>r(h=>{h.logLevel=d})})),e.createElement(H,{className:"flex flex-col flex-1 mt-2.5 md:mt-4"},e.createElement("ul",{className:"logs-panel",ref:n},s.map((d,h)=>e.createElement("li",{className:"leading-5 inline-block",key:h},e.createElement("span",{className:"mr-2 text-orange-400"},"[",Pe(d.time).format("YYYY-MM-DD HH:mm:ss"),"]"),e.createElement("span",{className:En.get(d.type)},"[",d.type.toUpperCase(),"]"),e.createElement("span",null," ",d.payload))))))}var xe=(n=>(n.SPEED_NOTIFY="speed-notify",n))(xe||{});class yn{constructor(){this.EE=new He}notifySpeedTest(){this.EE.emit("speed-notify")}subscribe(t,s){this.EE.addListener(t,s)}unsubscribe(t,s){this.EE.removeListener(t,s)}}var ge=new yn;const Te={"#909399":0,"#57b366":260,"#ff9a28":600,"#ff3e5e":1/0};function ot(n){const{config:t,className:s}=n,{set:o}=de(),a=z(),l=m.exports.useCallback(async p=>{var h;if(se())return(h=await(P==null?void 0:P.getProxyDelay(p)))!=null?h:0;const{data:{delay:d}}=await a.getProxyDelay(p);return d},[a]),r=m.exports.useCallback(async function(){const p=await Oe.fromPromise(l(t.name),h=>h),d=p.isErr()?0:p.value;o(h=>{const g=h.proxies.find(v=>v.name===t.name);g!=null&&g.history.push({time:Date.now().toString(),delay:d})})},[t.name,l,o]),i=m.exports.useMemo(()=>{var p;return(p=t.history)!=null&&p.length?t.history.slice(-1)[0].delay:0},[t]);m.exports.useLayoutEffect(()=>{const p=()=>{r()};return ge.subscribe(xe.SPEED_NOTIFY,p),()=>ge.unsubscribe(xe.SPEED_NOTIFY,p)},[r]);const u=m.exports.useMemo(()=>i===0,[i]),E=m.exports.useMemo(()=>Object.keys(Te).find(p=>i<=Te[p]),[i]),f=u?void 0:E;return e.createElement("div",{className:w("proxy-item",{"proxy-error":u},s)},e.createElement("span",{className:"proxy-type",style:{backgroundColor:f}},t.type),e.createElement("p",{className:"proxy-name"},t.name),e.createElement("p",{className:"proxy-delay",style:{color:E}},i===0?"-":`${i}ms`),e.createElement("span",{className:"proxy-udp"},t.udp.valueOf()?"UDP":null))}function xn(n){const{markProxySelected:t}=de(),[s]=O(Ze),{data:o}=me(),a=z(),{config:l}=n;async function r(E){if(await a.changeProxySelected(n.config.name,E),t(n.config.name,E),o.breakConnections){const f=[],p=await a.getConnections();for(const d of p.data.connections)d.chains.includes(n.config.name)&&f.push(d.id);await Promise.all(f.map(d=>a.closeConnection(d)))}}const i=m.exports.useMemo(()=>{var f;const E=new Set;for(const p of l.all){const d=(f=s.get(p))==null?void 0:f.history;(d==null?void 0:d.length)&&d.slice(-1)[0].delay===0&&E.add(p)}return E},[l.all,s]),u=l.type==="Selector";return e.createElement("div",{className:"proxy-group"},e.createElement("div",{className:"flex h-10 mt-4 w-full items-center justify-between md:h-15 md:mt-0 md:w-auto "},e.createElement("span",{className:"h-6 px-5 w-35 overflow-hidden overflow-ellipsis whitespace-nowrap md:w-30"},l.name),e.createElement(ne,{className:"mr-5 md:mr-0"},l.type)),e.createElement("div",{className:"flex-1 py-2 md:py-4"},e.createElement(qt,{className:"ml-5 md:ml-8",data:l.all,onClick:r,errSet:i,select:l.now,canClick:u,rowHeight:30})))}function gn(n){const{subscriptionInfo:t,className:s,style:o}=n,a=w("progress",s),l=C({},o),r=I(C({},n),{className:a,style:l}),i=t?Me((t==null?void 0:t.Download)+(t==null?void 0:t.Upload)):0,u=t?Me(t.Total):0,E=t?((t.Download+t.Upload)/t.Total*100).toFixed(2):0;return e.createElement("div",C({},r),e.createElement("div",{className:"progress-info"},i," / ",u," (",E.toString()+"%",")"),e.createElement("div",{className:"progress-fill",style:{width:E.toString()+"%"}}))}function Me(n,t=2){if(n){const o=t<0?0:t,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],l=Math.floor(Math.log(n)/Math.log(1024));return`${parseFloat((n/Math.pow(1024,l)).toFixed(o))} ${a[l]}`}else return"0 Bytes"}function vn(n){const{update:t}=Ke(),{translation:s,lang:o}=D(),a=z(),{provider:l}=n,{t:r}=s("Proxies"),{visible:i,hide:u,show:E}=Fe();function f(){E(),a.healthCheckProvider(l.name).then(async()=>await t()).finally(()=>u())}const p=m.exports.useMemo(()=>{var S;if(!((S=l.subscriptionInfo)!=null&&S.Expire))return;const g=new Date(l.subscriptionInfo.Expire*1e3),v=g.getFullYear().toString()+"-",F=(g.getMonth()+1<10?"0"+(g.getMonth()+1).toString():g.getMonth()+1).toString()+"-",k=g.getDate().toString()+" ";return v+F+k},[l.subscriptionInfo]);function d(){E(),a.updateProvider(l.name).then(async()=>await t()).finally(()=>u())}const h=m.exports.useMemo(()=>l.proxies.slice().sort((g,v)=>-1*ve(g,v)),[l.proxies]);return e.createElement(H,{className:"proxy-provider"},e.createElement(st,{visible:i}),e.createElement("div",{className:"flex flex-col justify-between md:flex-row md:items-center"},e.createElement("div",{className:"flex items-center flex-wrap gap-4"},e.createElement("span",{className:"mr-2"},l.name),e.createElement(ne,null,l.vehicleType),e.createElement(ne,{className:"rule-provider-behavior m-0"},l.proxies.length),p&&e.createElement(ne,{className:"rule-provider-expire m-0"},"Expire: ",p),l.subscriptionInfo&&e.createElement(gn,{subscriptionInfo:l.subscriptionInfo})),e.createElement("div",{className:"flex pt-3 items-center md:pt-0 flex-none"},l.updatedAt&&e.createElement("span",{className:"text-sm"},`${r("providerUpdateTime")}: ${Ae(new Date(l.updatedAt),o)}`),e.createElement(U,{className:"cursor-pointer text-red pl-5",type:"healthcheck",size:18,onClick:f}),e.createElement(U,{className:"cursor-pointer pl-5",type:"update",size:18,onClick:d}))),e.createElement("ul",{className:"proxies-list"},h.map(g=>e.createElement("li",{key:g.name},e.createElement(ot,{className:"proxy-provider-item",config:g})))))}const wn={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function ve(n,t){const s=n.history.length>0?n.history.slice(-1)[0].delay:0;return((t.history.length>0?t.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(s||Number.MAX_SAFE_INTEGER)}function Cn(){const{groups:n,global:t}=de(),{data:s,set:o}=me(),{general:a}=De(),{translation:l}=D(),{t:r}=l("Proxies"),i=m.exports.useMemo(()=>a.mode==="global"?[t,...n]:n,[a,n,t]);return e.createElement(e.Fragment,null,i.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(X,{title:r("groupTitle")},e.createElement(nt,{className:"cursor-pointer text-sm text-shadow-primary text-[#619cc2]",checked:s.breakConnections,onChange:u=>o("breakConnections",u)},r("breakConnectionsText"))),e.createElement(H,{className:"my-2.5 p-0 md:my-4"},e.createElement("ul",{className:"list-none divide-y divide-gray-300"},i.map(u=>e.createElement("li",{key:u.name},e.createElement(xn,{config:u})))))))}function bn(){const{providers:n}=Ke(),{translation:t}=D(),{t:s}=t("Proxies");return e.createElement(e.Fragment,null,n.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(X,{title:s("providerTitle")}),e.createElement("ul",{className:"list-none"},n.map(o=>e.createElement("li",{className:"my-2.5 md:my-4",key:o.name},e.createElement(vn,{provider:o}))))))}function Nn(){const{proxies:n}=de(),{translation:t}=D(),{t:s}=t("Proxies");function o(){ge.notifySpeedTest()}const{current:a,next:l}=nn([1,2,0]),r=m.exports.useMemo(()=>{switch(a){case 2:return n.slice().sort((u,E)=>ve(u,E));case 1:return n.slice().sort((u,E)=>-1*ve(u,E));default:return n.slice()}},[a,n]),i=l;return e.createElement(e.Fragment,null,r.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(X,{title:s("title")},e.createElement(U,{className:"ml-3",type:wn[a],onClick:i,size:20}),e.createElement(U,{className:"ml-3",type:"speed",size:20}),e.createElement("span",{className:"proxies-speed-test text-[#619cc2]",onClick:o},s("speedTestText"))),e.createElement(H,{className:"proxy-provider"},e.createElement("ul",{className:"proxies-list"},r.map(u=>e.createElement("li",{key:u.name},e.createElement(ot,{config:u})))))))}function Pn(){return e.createElement("div",{className:"page"},e.createElement(Cn,null),e.createElement(bn,null),e.createElement(Nn,null))}function Sn(n){const{update:t}=Ye(),{translation:s,lang:o}=D(),a=z(),{provider:l}=n,{t:r}=s("Rules"),{visible:i,hide:u,show:E}=Fe();function f(){E(),a.updateRuleProvider(l.name).then(async()=>await t()).finally(()=>u())}const p=w("rule-provider-icon",{"rule-provider-loading":i});return e.createElement("div",{className:"rule-provider"},e.createElement("div",{className:"rule-provider-header"},e.createElement("div",{className:"rule-provider-header-part"},e.createElement("span",{className:"rule-provider-name"},l.name),e.createElement(ne,null,l.vehicleType),e.createElement(ne,{className:"rule-provider-behavior"},l.behavior),e.createElement("span",{className:"rule-provider-update"},`${r("ruleCount")}: ${l.ruleCount}`)),e.createElement("div",{className:"rule-provider-header-part"},l.updatedAt&&e.createElement("span",{className:"rule-provider-update"},`${r("providerUpdateTime")}: ${Ae(new Date(l.updatedAt),o)}`),e.createElement(U,{className:p,type:"update",size:18,onClick:f}))))}function kn(){const{providers:n}=Ye(),{translation:t}=D(),{t:s}=t("Rules");return e.createElement(e.Fragment,null,n.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(X,{title:s("providerTitle")}),e.createElement(H,{className:"divide-y rounded shadow-primary mt-4 p-0"},n.map(o=>e.createElement(Sn,{key:o.name,provider:o})))))}function Dn(){const{rules:n,update:t}=Yt(),{translation:s}=D(),{t:o}=s("Rules");ee("rules",t);function a({index:l,style:r}){const i=n[l],u=i.size||-1;return e.createElement("li",{className:"rule-item",style:r},e.createElement("div",{className:"flex py-1"},e.createElement("div",{className:"text-center w-40 rule-type"},i.type),e.createElement("div",{className:"flex-1 text-center payload"}," ",u!==-1?`${i.payload} :: ${u}`:i.payload),e.createElement("div",{className:"text-center w-40 rule-proxy"},i.proxy)))}return e.createElement("div",{className:"page"},e.createElement(kn,null),e.createElement(X,{className:"not-first:mt-7.5",title:o("title")}),e.createElement(H,{className:"flex flex-col flex-1 mt-2.5 p-0 md:mt-4 focus:outline-none text-sm"},e.createElement(Pt,{className:"min-h-120"},({height:l,width:r})=>e.createElement(St,{height:l,width:r,itemCount:n.length,itemSize:40},a))))}const Fn=[{label:"\u4E2D\u6587",value:"zh_CN"},{label:"English",value:"en_US"}];function An(){var ae,ce,ie;const{premium:n}=Je(),{data:t,update:s}=Qe(),{general:o,update:a}=De(),l=be(ke),r=re(),{translation:i,setLang:u,lang:E}=D(),{t:f}=i("Settings"),p=z(),[d,h]=ue({mixedProxyPort:0,socks5ProxyPort:7891,httpProxyPort:7890,redirProxyPort:7892});m.exports.useEffect(()=>{var c,b,y,L;h("socks5ProxyPort",(c=o==null?void 0:o.socksPort)!=null?c:0),h("httpProxyPort",(b=o==null?void 0:o.port)!=null?b:0),h("mixedProxyPort",(y=o==null?void 0:o.mixedPort)!=null?y:0),h("redirProxyPort",(L=o==null?void 0:o.redirPort)!=null?L:0)},[o,h]);async function g(c){await p.updateConfig({mode:c}),await a()}async function v(c){await(P==null?void 0:P.setStartAtLogin(c)),await s()}async function F(c){await(P==null?void 0:P.setSystemProxy(c)),await s()}function k(c){u(c)}async function S(){await p.updateConfig({port:d.httpProxyPort}),await a()}async function V(){await p.updateConfig({"socks-port":d.socks5ProxyPort}),await a()}async function N(){await p.updateConfig({"mixed-port":d.mixedProxyPort}),await a()}async function j(){await p.updateConfig({"redir-port":d.redirProxyPort}),await a()}async function R(c){await p.updateConfig({"allow-lan":c}),await a()}const{hostname:$,port:B}=r,{allowLan:oe,mode:te}=o,T=(ae=t==null?void 0:t.startAtLogin)!=null?ae:!1,Y=(ce=t==null?void 0:t.systemProxy)!=null?ce:!1,J=(ie=t==null?void 0:t.isClashX)!=null?ie:!1,K=m.exports.useMemo(()=>{const c=[{label:f("values.global"),value:"Global"},{label:f("values.rules"),value:"Rule"},{label:f("values.direct"),value:"Direct"}];return n&&c.push({label:f("values.script"),value:"Script"}),c},[f,n]);return e.createElement("div",{className:"page"},e.createElement(X,{title:f("title")}),e.createElement(H,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between "},e.createElement("span",{className:"font-bold label"},f("labels.language")),e.createElement(Re,{options:Fn,value:E,onSelect:c=>k(c)})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between "},e.createElement("span",{className:"font-bold label"},f("labels.allowConnectFromLan")),e.createElement(fe,{checked:oe,onChange:R}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between "},e.createElement("span",{className:"font-bold label"},f("labels.proxyMode")),e.createElement(Re,{options:K,value:kt(te),onSelect:g})))),J&&e.createElement(H,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},f("labels.startAtLogin")),e.createElement(fe,{checked:T,onChange:v})),e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},f("labels.setAsSystemProxy")),e.createElement(fe,{checked:Y,onChange:F})))),e.createElement(H,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},f("labels.mixedProxyPort")),e.createElement(Z,{className:"w-28",disabled:J,value:d.mixedProxyPort,onChange:c=>h("mixedProxyPort",+c),onBlur:N})),e.createElement("div",{className:"flex  w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},f("labels.redirProxyPort")),e.createElement(Z,{className:"w-28",disabled:J,value:d.redirProxyPort,onChange:c=>h("redirProxyPort",+c),onBlur:j}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},f("labels.socks5ProxyPort")),e.createElement(Z,{className:"w-28",disabled:J,value:d.socks5ProxyPort,onChange:c=>h("socks5ProxyPort",+c),onBlur:V})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},f("labels.httpProxyPort")),e.createElement(Z,{className:"w-28",disabled:J,value:d.httpProxyPort,onChange:c=>h("httpProxyPort",+c),onBlur:S})),e.createElement("div",{className:"flex flex-wrap w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},f("labels.externalController")),e.createElement("span",{className:w({"modify-btn":!J},"external-controller"),onClick:()=>!J&&l(!1)},`${$}:${B}`)))))}var $n="./assets/logo.0dc1c7df.png";function Ln(n){const{routes:t}=n,{translation:s}=D(),{version:o,premium:a,meta:l}=Je(),{data:r}=Qe(),{t:i}=s("SideBar"),u=Ce(),E=t.map(({path:f,name:p,noMobile:d})=>e.createElement("li",{className:w("item",{"no-mobile":d}),key:p},e.createElement(Dt,{to:{pathname:f,search:u.search},className:({isActive:h})=>w({active:h})},i(p))));return e.createElement("div",{className:"sidebar"},e.createElement("img",{src:$n,alt:"logo",className:"sidebar-logo"}),e.createElement("ul",{className:"sidebar-menu"},E),e.createElement("div",{className:"sidebar-version"},e.createElement("span",{className:"sidebar-version-label"},"Clash",(r==null?void 0:r.isClashX)&&"X"," ",i("Version")),e.createElement("span",{className:"sidebar-version-text"},o),a&&e.createElement("span",{className:"sidebar-version-label"},"Premium"),l&&e.createElement("span",{className:"sidebar-version-label"},"Meta")))}function In(){et();const n=Ce(),t=[{path:"/proxies",name:"Proxies",element:e.createElement(Pn,null)},{path:"/logs",name:"Logs",element:e.createElement(hn,null)},{path:"/rules",name:"Rules",element:e.createElement(Dn,null),noMobile:!0},{path:"/connections",name:"Connections",element:e.createElement(dn,null),noMobile:!1},{path:"/settings",name:"Settings",element:e.createElement(An,null)}],s=e.createElement("div",{className:w("app",{"not-clashx":!se()})},e.createElement(Ln,{routes:t}),e.createElement("div",{className:"page-container"},e.createElement(Ft,null)),e.createElement(pn,null));return e.createElement(At,null,e.createElement(pe,{path:"/",element:s},e.createElement(pe,{path:"/",element:e.createElement($t,{to:{pathname:"/proxies",search:n.search},replace:!0})}),t.map(o=>e.createElement(pe,{path:o.path,key:o.path,element:o.element}))))}function ze(){const n=document.getElementById("root"),t=e.createElement(m.exports.StrictMode,null,e.createElement(It,null,e.createElement(m.exports.Suspense,{fallback:e.createElement(st,{visible:!0})},e.createElement(In,null))));Lt(n).render(t)}se()?Tt(()=>ze()):ze();
